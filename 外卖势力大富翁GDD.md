# 外卖势力大富翁（H5）— GDD（策划迭代版）

版本：v0.1（基于当前实现）  
维护方式：每次玩法/数值/内容改动，在本文件对应章节补充“变更记录”与“待验证项”。

---

## 1. 游戏概述

### 1.1 一句话描述
手机竖屏的回合制地图棋盘小游戏：通过移动、经营店铺券、命运事件与势力技能，在有限资源（电量/资金）约束下率先集齐目标店铺券数量获胜。

### 1.2 目标平台与形态
- 平台：移动端浏览器（H5），可部署 Cloudflare Pages
- 方向：轻量、快节奏、单局可复玩、策略与随机并存
- 屏幕：竖屏优先（沉浸式全屏）

### 1.3 核心卖点（Pillars）
- 走格子 + 选路：地图连线提供路径选择与风险控制
- 资源约束：电量决定行动能力，资金决定经营能力
- 强对抗：技能干扰（暂停/转化）+ 命运事件制造波动
- 轻收集：店铺券（按名称去重）作为胜利进度

---

## 2. 目标用户与体验指标

### 2.1 目标用户
- 喜欢大富翁/棋盘类、轻策略对抗与随机事件的玩家
- 偏休闲：单局 5–12 分钟，易上手

### 2.2 体验指标（建议）
- 上手时间：30 秒内完成开局设置并开始掷骰
- 关键爽点：获得关键店铺券、触发连锁命运、技能反杀
- 可复玩：同一玩家连续玩 3 局仍能看到新组合/新事件

---

## 3. 单局流程与胜负规则

### 3.1 开局设置（Setup）
1. 选择胜利目标（店铺券数量）：5–10（可扩展）
2. 选择玩家数：2–4（可扩展）
3. 逐个选择势力（不可重复）

### 3.2 胜利条件
- 任意玩家拥有的“不同店铺券名称”数量 ≥ `victoryTarget` 时立刻获胜
- 判定时机：购买店铺后立即判定

### 3.3 回合定义
建议约定：
- “轮（Round）”：所有玩家各行动一次算一轮
- “回合（Turn）”：当前行动玩家的一次完整行动

当前实现里全局 `turn` 在轮结束时 +1（索引回到 0 时）。

---

## 4. 核心系统（当前实现对齐）

### 4.1 地图系统
#### 4.1.1 规模与类型分布
- 节点总数：40
- 类型数量：
  - 店铺：10
  - 命运：8
  - 充电桩：4
  - 打工点：4
  - 医院：2
  - 普通：12

#### 4.1.2 布局与连接
- 双环布局：外环 24 + 内环 16
- 主连接：i -> i+1（构成闭环）
- 捷径：概率性添加 3–8 步的近距离连接（控制交叉与复杂度）

#### 4.1.3 策划可调参数（平衡旋钮）
- 节点数量、类型配比
- 捷径概率与距离范围
- 各类型节点在地图中的分布规则（未来可做：对称/分区/权重）

### 4.2 移动系统
#### 4.2.1 掷骰
- 点数：1–3
- 触发条件：当前玩家处于可行动阶段（IDLE）

#### 4.2.2 分步移动（点击相邻节点）
- 每次移动必须走向当前节点的 `connections` 邻居
- 移动步数由掷骰决定，走一步消耗一次电量成本

#### 4.2.3 电量消耗
默认：每步消耗 0.5  
可被势力被动覆盖：`moveCost`

### 4.3 资源系统
#### 4.3.1 电量（Power）
用途：移动成本、部分技能成本  
主要获取：充电桩、命运事件、势力周期回复

#### 4.3.2 资金（Money）
用途：购买店铺券、部分技能成本、紧急充电惩罚  
主要获取：打工点、命运事件、势力周期回复、店铺返利

### 4.4 紧急充电（Fail-safe）
触发：掷骰前若电量不足以支付一步移动成本  
效果（当前实现）：
- 随机传送至充电桩
- 扣 2 元
- 电量补至该势力的 `chargerBonus`（等价于“充一次就到位”）
- 结束回合

策划目标：
- 防止“电量不足卡死”
- 让资源管理产生代价而非不可行动

可迭代方向：
- 传送“最近充电桩”（需要距离定义）
- 罚金/补电量随回合数或落后程度动态调整

---

## 5. 节点（格子）规则

### 5.1 店铺（shop）
#### 5.1.1 到达未拥有店铺
- 弹窗提示：店铺名称、品类、价格、当前资金
- 选择：
  - 离开：不买，结束回合
  - 购买：扣钱，获得该店铺券，触发后续判定

#### 5.1.2 价格计算（当前实现）
基础：地图生成时为店铺随机赋价 3–10  
叠加项：
- 势力额外加价：`shopCostExtra`
- buff 折扣：`discount_2`（购买时消耗）
- 叮咚折扣：连续 3 回合不进命运，下次购买 -2（最低 3）

#### 5.1.3 已拥有该店铺
当前实现：+1 元后结束回合（可扩展）

#### 5.1.4 购买后衍生
- 美团：购买甜品/饮品类店铺返利 +2（≥3 券后变 +3）
- 胜利判定：购买后立即判定胜利

### 5.2 充电桩（charger）
- 增加电量：`chargerBonus`（势力不同）
- 受状态影响：电池老化期间无法充电

### 5.3 打工点（money）
- 增加资金：`moneyStationBonus`（势力不同）

### 5.4 医院（hospital）
- 默认：下回合暂停（`isSkipped = true`）
- 叮咚免疫：到达医院不受影响

### 5.5 命运（fate）
进入后抽取一条命运事件，并展示弹窗确认。

事件可能：
- 直接增减资源（money/power）
- 给予 buff（一次性或持续）
- 位移（随机/定向/交换）
- 改变行动节奏（额外回合/暂停敌人）
- 连锁触发（关闭弹窗后继续结算新落点）

---

## 6. Buff / 状态 / 冷却

### 6.1 Buff 分类
#### 6.1.1 一次性/瞬时 buff（字符串）
- `move_minus_1`：下一次掷骰 -1（最低 1），掷骰时消耗
- `discount_2`：下次购买店铺 -2（购买时消耗）

#### 6.1.2 持续 buff（对象）
- `no_charger_5_turns`：若干回合内无法从充电桩获得电量

### 6.2 回合结束处理（当前实现）
- 对“刚行动结束的玩家”递减持续 buff 的 `duration`
- 删除 `duration <= 0` 的持续 buff

### 6.3 冷却
#### 6.3.1 主动技能冷却
- 使用后设置 `skillCooldown`
- 在后续回合递减（当前实现为在轮到该玩家时递减）

#### 6.3.2 饿了么高电量返利冷却
- 逻辑：若电量 > 阈值（默认 10）且冷却为 0，则获得资金并进入冷却

---

## 7. 势力（Factions）设计

### 7.1 势力列表（当前）
- 叮咚买菜：稳定运营流（医院免疫、周期回复、连续不进命运折扣）
- 国潮外卖：干扰控场流（主动暂停对手，移动更耗电，买店更贵）
- 美团外卖：连锁经营流（购买甜品/饮品返利，集券越多返利越高）
- 饿了么：电量爆发流（充电收益高，高电量返利，电换钱主动技能）

### 7.2 势力配置字段（策划口径）
每个势力建议字段：
- `initialPower` / `initialMoney`
- `passives`：
  - `powerRegen` / `moneyRegen`
  - `chargerBonus` / `moneyStationBonus`
  - `moveCost` / `shopCostExtra`
  - `hospitalImmunity`
  - `shopDiscountCondition`
  - `shopBonusTypes` / `shopBonusAmount` / `shopBonusBuffCondition`
  - `highPowerBonus`
- `activeSkill`（可选）：成本、效果、冷却

### 7.3 平衡原则（建议）
- 初始资源差异要能体现定位，但不能让某势力“开局必优”
- 资源产出（打工/充电/周期）与资源消耗（移动/买店/技能）要可量化对比
- 主动技能需要“成本 + 冷却 + 反制窗口”，避免单一最优解

---

## 8. 命运事件系统（内容模板）

### 8.1 事件分类（建议）
- 资源波动：纯 money/power 增减（短反馈）
- 状态扰动：buff/debuff（中反馈）
- 位移类：位置改变（引发连锁与路线变化）
- 对抗类：偷钱/暂停/交换（增强互动）
- 节奏类：额外回合/减步（制造转折）
- 选择类：玩家二选一/多选一（增强策略与可控性）

### 8.2 事件数据结构（建议统一）
```
{
  id: number,
  text: string,
  type?: string,
  effect?: { money?: number, power?: number, buff?: string | { id, duration, ... } },
  cost?: number,
  amount?: number,
  targets?: string[],
  options?: [{ text: string, effect: { money?: number, power?: number, buff?: ... } }]
}
```

### 8.3 内容产能建议（迭代计划）
- MVP：20–30 条事件，覆盖所有分类
- v0.2：加入“势力专属命运”“店铺品类联动命运”
- v0.3：加入“选择事件”为主的事件树（小剧情）

---

## 9. UI/UX（竖屏 H5）

### 9.1 主界面
- 地图居中显示，节点可点击移动
- 顶部 HUD：当前行动者、掷骰按钮、面板展开/收起
- 底部面板：玩家列表、技能按钮、掷骰、状态提示与日志

### 9.2 弹窗
- 店铺弹窗：展示价格与资金，允许购买/离开
- 命运弹窗：展示事件文本，确认后继续（可能连锁）

### 9.3 体验增强（可选）
- 新手引导：强调“电量是移动成本”“命运有连锁”
- 震动/音效：关键节点（掷骰、买店、命运、胜利）
- 全屏/PWA：提升沉浸感与留存

---

## 10. AI（人机对战）— 设计草案

目标：让单人可玩、并为联机掉线托管提供基础。

### 10.1 决策点
- 是否掷骰（通常必掷）
- MOVING 时每一步走向哪个邻居
- 店铺弹窗：买/不买
- 主动技能：何时用、对谁用

### 10.2 初版启发式（建议）
- 选路：
  - 优先走向“未拥有店铺”且价格可承受的节点（若可预估）
  - 电量不足风险高时优先走向充电桩/打工点
  - 若领先则走安全（少命运），落后则走高波动（多命运）
- 买店：
  - 若资金充足且能推进胜利目标，则倾向购买
  - 若价格过高或会导致紧急充电频发，则放弃
- 技能：
  - 控场技能优先干扰“最接近胜利的对手”
  - 转化技能在“资金不足以买店但电量富余”时使用

---

## 11. 联机（多人对战）— 设计草案

### 11.1 权威状态模型
- 服务端/房间为权威，客户端只提交意图（Action）
- 随机性统一由 seed 驱动，保证一致性与可重放

### 11.2 房间与流程
- 创建房间、加入房间、准备、开始
- 回合制：只允许当前玩家发送行动意图
- 断线重连：通过 Action log 重放恢复
- 掉线托管：AI 接管（与 10 章共用）

---

## 12. 数值表（当前实现快照）

> 本节用于“策划对齐当前实现”。后续建议将可调数值集中到单独的 data 文件并在此处同步。

### 12.1 地图
- 节点：40
- 店铺数：10
- 命运数：8
- 充电桩数：4
- 打工点数：4
- 医院数：2
- 普通数：12

### 12.2 掷骰
- 1–3

### 12.3 移动成本
- 默认每步 0.5 电量
- 国潮每步 0.75 电量

### 12.4 紧急充电
- 罚金：-2 元
- 传送：随机充电桩
- 补电：充电桩收益（按势力）

### 12.5 势力（示例字段，详见 data）
- 叮咚：初始电 10 / 钱 8；充电 +6；打工 +8；医院免疫；连续不进命运折扣
- 国潮：初始电 13 / 钱 16；移动更耗电；买店更贵；主动暂停对手（-5 元）
- 美团：初始电 6 / 钱 12；买甜品/饮品返利（集券越多返利越高）
- 饿了么：初始电 8 / 钱 10；充电 +10；高电量返利；电换钱技能

---

## 13. 版本规划与 Roadmap（策划拆解）

### 13.1 v0.2（内容扩充 + 可玩性增强）
- 命运事件扩充到 25+，增加更多“选择型事件”
- 店铺券机制扩展（例如：同品类套装加成/一次性道具券）
- 优化回合信息展示：把胜利进度、关键 buff 可视化

### 13.2 v0.3（人机对战）
- 引入 CPU 玩家（启发式 3 档难度）
- 形成“策略回合 -> 结果可复盘”的闭环（seed + 回放）

### 13.3 v0.4（联机雏形）
- 房间系统 + 回合锁（只允许当前玩家操作）
- 权威状态与同步机制（Action log + seed）
- 掉线重连 + AI 托管

---

## 14. 验收标准（QA Checklist）

### 14.1 功能验收
- 能完成 Setup 并开始游戏
- 移动只能走相邻连接，步数正确扣减
- 电量每步扣除正确，电量不足触发紧急充电且不会卡死
- 店铺购买价格与折扣逻辑正确，购买后胜利判定正确
- 命运事件：资源变化、buff 生效与消耗、位移与连锁结算正确
- 医院：非免疫势力能暂停一回合，免疫势力不受影响

### 14.2 体验验收（竖屏）
- 顶部 HUD 不遮挡关键操作；底部面板可展开/收起
- 弹窗在小屏不溢出、按钮可点击

---

## 15. 变更记录

- 2026-01-09：创建 GDD v0.1（基于当前实现梳理）

